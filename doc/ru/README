

                                  Введение

Стечение обстоятельств привело к появлению новой версии vimage, 
полностью переписанной и дополненной. Vimage — это удобный 
способ предварительного просмотра изображений. 


                                  Использование
								  
[Использование:системная панель]
На системной панели находится иконка запуска диалога просмотра 
изображения. Эту иконку можно скрыть, через соответствующую опцию 
в настройках. При нажатии левой кнопки мыши откроется новое окно 
Viewer (подробности далее). Если вы не загрузили ни одного изображения, 
то иконка проигнорирует ваши действия.

[Использование:инициализация]
При получении ссылки на изображения произойдет выбор действия, и плагин 
решит, скачать ли изображение, или нет. Если в опциях пункт автоматического 
скачивания имеет отрицательное значение, то ссылка будет игнорироваться
всегда. Стоит лишь отметить, что ссылке будет присвоена иконка чёрно-белого 
цвета, обозначающая, что действий над изображением ещё небыло произведено. 
В данном случае при нажатии на эту иконку будет запущен обработчик получения 
изображения. Если активирована опция автоматического скачивания изображения, 
то обработчик будет запущен в любом случае. 

[Использование:location]
Если активирована опция для получения заголовков, то будет произведён 
запрос на элемент "Location", если он не пуст, то вместо начальной ссылки 
будет скачано значение элемента "Location". Это полезно, когда ссылка не прямая, 
в этом случае плагин сам определит правильную ссылку. 

[Использование:ограничение на максимальный размер]
Далее будет совершено получение контента. Если размер последнего превышает
указанные в опциях ограничения, то скачивание остановится, иконка поменяет 
своё состояние на "Large", в этом случае, при щелчке на иконку, изображение будет
перезагружено, но все ограничения деактивируются, и картинка будет скачана при 
любом исходе (кроме варианта с ошибкой получения контента/созданием изображения).

[Использование:индикатор]
Если скачивание началось и пункт опции создания и индикатора активен, то в нижней 
части Tkabber будет создан индикатор получения изображения. Слева от него будет
указан адрес, из какой конференции/чата производится скачивание. Справа от
индикатора создастся метка, показывающая сколько/из_скольких килобайт
скачано. Если сервер не дал возможности получения элемента заголовка
"Content-Length", то будет показано однозначное число. Цвет метки изначально имеет
красный цвет. При получении 50% и более размера метка поменяет цвет на зелёный
Про окончании скачивания индикатор будет удалён автоматически.

[Использование:изображение получено]
При получении изображения, если небыло ошибок, и если активирована опция 
для показа тултипа с уменьшенным вариантом изображения, то будет произведена привязка 
к иконке состояния, и при наведении курсора мыши будет показано небольшое изображение,
в котором вы сможете увидеть само изображение. Тултип использует механизм уменьшения
изображения, подробнее об этом далее. При щелчке мыши на иконке состояния будет открыт
Viewer.

[Использование:меню для ссылки]
При клике ПКМ по ссылке (обычные ссылки не игнорируются, это сделано специально,
для тех случаев, когда регулярное выражение не справляется с определением правильности
ссылки) открывается меню, которое содержит следующие элементы:
Показать изображение
Получить изображение
Перезагрузить изображение
Перезагрузить изображение без ограничений на размер
Состояние элемента зависит от состояния иконки изображения.


                                  Viewer
							
[Viewer:открытие]
Открытие интерфейса просмотра изображения сопровождается изминением состояния
History (левая панель с историей показа изображений). Будет ли она скрыта или открыта 
определяет конфигурация настроек. При открытии Viewer последнее полученное изображение
будет автоматически показано в основном окне.

[Viewer:history]
История показа изображения показывает ссылки, ссылки сгрупперованы по названиям 
конференций/чатов. Группу, которая имеет чёрный фон, можно скрыть. Так же есть 
кнопка скрытия всех групп. В этом случае группа, в которой находится активная 
ссылка на изображения не будет тронута. Есть обратная 
возможность - раскрыть все группы. Последняя полученная ссылка выделяется зелёным
цветом. Активная ссылка выделяется красным цветом. Навигация по изображениям
происходит посредством щелчка левой кнопки мыши на элемент группы.

[Viewer:основное окно]
В основном окне показано изображение активного элемента History. Изображение
меняется при навигации по History.

[Viewer:панель управления]
В самой нижней части Viewer есть панель, на которой находятся кнопки управления
Viewer: Увеличение/Уменьшение изображения, Скрыть все группы, Показать все группы,
Сохранить изображение, Скрыть/Показать History.

[Viewer:привязки]
Viewer имеет несколько комбинаций клавиш для быстрого управления.
Space - Скрыть/Показать History.
Esc - Скрыть Viewer.
Double-1 (Двойной щелчок ЛКМ) - Развернуть viewer.
3 (ПКМ на изображении) - Показать меню.

[Viewer:меню]
Меню содержит следующие элементы:
Скопировать URL в буфер обмена.
Сохранить изображение.
Скрыть Viewer.
Развернуть экран.
Скрыть/Показать History.
Масштабирование изображения:
  Увеличить
  Отдалить
  Нормальный размер.
  
[Viewer:прокрутка изображения]
На основном окне просмотра изображения показаны две
полосы прокрутки. Если изображение не умещается в экран, 
то его можно двигать этими полосами. Если вам удобнее двигать изображение,
зажав ЛКМ, то вы можете сделать и это. Правда здесь остался неисправлен 
один недочёт - изображение можно двигать, если оно меньше экрана просмотра
изображения.

Установка расширения TkImageTools:
В директории lib/TkImageTools находятся два файла:
TkImageTools.c и Makefile. Вам потребуется gcc для компиляции
(если изменить строку COMPILER = gcc в Makefile, то можно воспользоваться
любым другим схожим компилятором). Процесс довольно прост: вы пишете команду
make в директории с файлом Makefile, компилятор обработает исходный файл 
TkImageTools и выдаст вам бинарную библиотеку. Это в том случае, если у вас 
tcl версии 8.5, если нет, то отредактируйте файл Makefile.